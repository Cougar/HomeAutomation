   1               		.file	"mcp2515.c"
   2               		.arch atmega168
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  11               		.text
  12               	.Ltext0:
  71               	.global	MCP2515_Reset
  73               	MCP2515_Reset:
   1:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /******************************************************************************
   2:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
   3:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Controller Area Network (CAN) Demo-Application
   4:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Atmel AVR with Microchip MCP2515 
   5:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
   6:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Copyright (C) 2005 Martin THOMAS, Kaiserslautern, Germany
   7:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * <eversmith@heizung-thomas.de>
   8:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * http://www.siwawi.arubi.uni-kl.de/avr_projects
   9:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
  10:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *****************************************************************************
  11:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
  12:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * File    : mcp2515.c
  13:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Version : 0.9
  14:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
  15:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Summary : MCP2515 "low-level" driver
  16:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
  17:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Parts of this code are adapted from a MCP2510 sample-application 
  18:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * by KVASER AB, http://www.kvaser.com (KVASER-code is marked as free)
  19:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
  20:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * This code-module is free to use but you have to keep the copyright
  21:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * notice.
  22:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
  23:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *****************************************************************************/
  24:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  25:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <inttypes.h>
  26:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** //#include <stdio.h>
  27:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <avr/io.h>
  28:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <avr/interrupt.h>
  29:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <drivers/can/mcp2515/mcp2515.h>
  30:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <drivers/can/mcp2515/mcp2515_defs.h>
  31:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <drivers/can/mcp2515/mcp2515_bittime.h>
  32:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  33:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #include <vectors.h>
  34:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  35:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  36:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #define SPI_PORT	PORTB
  37:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #define SPI_PIN		PINB
  38:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #define SPI_DDR		DDRB
  39:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  40:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #if defined(__AVR_ATmega8__) || defined(__AVR_ATmega88__) || defined(__AVR_ATmega168__)
  41:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_SCK   PB5  
  42:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_MISO  PB4 
  43:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_MOSI  PB3  
  44:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #elif defined(__AVR_ATmega32__) || defined(__AVR_ATmega16__)
  45:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_SCK   PB7
  46:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_MISO  PB6 
  47:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#define SPI_MOSI  PB5  
  48:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #else
  49:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#error "SPI pins undefined for this target (see spi.h)"
  50:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #endif
  51:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  52:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static void SPI_Init(void);
  53:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static uint8_t SPI_ReadWrite(uint8_t data);
  54:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static uint8_t SPI_Read(void);
  55:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  56:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #define SPI_DONTCARE (0x00)
  57:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  58:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** // init as SPI-Master
  59:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static void SPI_Init(void) {
  60:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// SCK, SS!!, MOSI as outputs
  61:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_DDR |= (1<<SPI_SCK) | (1<<SPI_MOSI);
  62:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// MISO as input
  63:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_DDR &= ~(1<<SPI_MISO);
  64:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// INIT interface, Master, set clock rate fck/4
  65:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPCR = (1<<SPE)|(1<<MSTR)|(0<<SPR0)|(0<<SPR1);
  66:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// enable double rate
  67:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPSR = (1<<SPI2X); // we will now gain fck/2 instead of fck/4
  68:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
  69:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  70:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static uint8_t SPI_ReadWrite(uint8_t data) {
  71:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// set data to send into SPI data register
  72:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPDR = data;
  73:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// Wait for transmission complete
  74:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	while(!(SPSR & (1<<SPIF)));
  75:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// return data read from SPI (if any)
  76:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return SPDR;
  77:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
  78:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  79:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static uint8_t SPI_Read(void) {
  80:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return SPI_ReadWrite(SPI_DONTCARE);
  81:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
  82:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  83:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** static Can_Message_t msgbuf;
  84:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  85:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_Reset(void) {
  75               	.LM0:
  76               	/* prologue: frame size=2 */
  77 0000 CF93      		push r28
  78 0002 DF93      		push r29
  79 0004 CDB7      		in r28,__SP_L__
  80 0006 DEB7      		in r29,__SP_H__
  81 0008 2297      		sbiw r28,2
  82 000a 0FB6      		in __tmp_reg__,__SREG__
  83 000c F894      		cli
  84 000e DEBF      		out __SP_H__,r29
  85 0010 0FBE      		out __SREG__,__tmp_reg__
  86 0012 CDBF      		out __SP_L__,r28
  87               	/* prologue end (size=10) */
  86:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
  89               	.LM1:
  90 0014 4398      		cbi 40-0x20,3
  91               	.LBB4:
  92               	.LBB5:
  94               	.LM2:
  95 0016 80EC      		ldi r24,lo8(-64)
  96 0018 8EBD      		out 78-0x20,r24
  97               	.L2:
  99               	.LM3:
 100 001a 0DB4      		in __tmp_reg__,77-0x20
 101 001c 07FE      		sbrs __tmp_reg__,7
 102 001e FDCF      		rjmp .L2
 104               	.LM4:
 105 0020 8EB5      		in r24,78-0x20
 106               	.LBE5:
 107               	.LBE4:
  87:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_RESET);
  88:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 109               	.LM5:
 110 0022 439A      		sbi 40-0x20,3
  89:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// delay at least 128 MCP clock cycles
  90:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	volatile int16_t i;
  91:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	for (i=0; i<32000; i++) {
 112               	.LM6:
 113 0024 1A82      		std Y+2,__zero_reg__
 114 0026 1982      		std Y+1,__zero_reg__
 115 0028 09C0      		rjmp .L4
 116               	.L5:
  92:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		if (i < 0) break;
 118               	.LM7:
 119 002a 8981      		ldd r24,Y+1
 120 002c 9A81      		ldd r25,Y+2
 121 002e 97FD      		sbrc r25,7
 122 0030 0AC0      		rjmp .L8
 124               	.LM8:
 125 0032 8981      		ldd r24,Y+1
 126 0034 9A81      		ldd r25,Y+2
 127 0036 0196      		adiw r24,1
 128 0038 9A83      		std Y+2,r25
 129 003a 8983      		std Y+1,r24
 130               	.L4:
 131 003c 8981      		ldd r24,Y+1
 132 003e 9A81      		ldd r25,Y+2
 133 0040 8050      		subi r24,lo8(32000)
 134 0042 9D47      		sbci r25,hi8(32000)
 135 0044 94F3      		brlt .L5
 136               	.L8:
 137               	/* epilogue: frame size=2 */
 138 0046 2296      		adiw r28,2
 139 0048 0FB6      		in __tmp_reg__,__SREG__
 140 004a F894      		cli
 141 004c DEBF      		out __SP_H__,r29
 142 004e 0FBE      		out __SREG__,__tmp_reg__
 143 0050 CDBF      		out __SP_L__,r28
 144 0052 DF91      		pop r29
 145 0054 CF91      		pop r28
 146 0056 0895      		ret
 147               	/* epilogue end (size=9) */
 148               	/* function MCP2515_Reset size 45 (26) */
 153               	.Lscope0:
 156               	.global	MCP2515_StartTransmit
 158               	MCP2515_StartTransmit:
  93:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
  94:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
  95:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
  96:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** uint8_t MCP2515_ReadRegister(const uint8_t address) {
  97:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t ret;
  98:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
  99:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 100:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_READ);
 101:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(address);
 102:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	ret = SPI_Read();
 103:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 104:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 105:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return ret;
 106:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 107:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 108:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*
 109:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_ReadRXBuf(const uint8_t buf, uint8_t* data) {
 110:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 111:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 112:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 113:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_READ_RX0 + ((buf & 0x1) << 2));
 114:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// mcp2515 has auto-increment of address-pointer
 115:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	for (i=0; i<13; i++) {
 116:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		data[i] = SPI_Read();
 117:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 118:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 119:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }*/
 120:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 121:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_SetRegister(const uint8_t address, const uint8_t value) {
 122:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 123:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_WRITE);
 124:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(address);
 125:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(value);
 126:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 127:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 128:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 129:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*
 130:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_SetRegisterS(const uint8_t address, const uint8_t values[], const uint8_t n) {
 131:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 132:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 133:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 134:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_WRITE);
 135:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(address);
 136:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// mcp2515 has auto-increment of address-pointer
 137:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	for (i=0; i<n; i++) {
 138:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		SPI_ReadWrite(values[i]);
 139:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 140:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 141:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }*/
 142:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 143:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_ModifyRegister(const uint8_t address, const uint8_t mask, const uint8_t data) {
 144:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 145:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_BITMOD);
 146:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(address);
 147:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(mask);
 148:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(data);
 149:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 150:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 151:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 152:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** uint8_t MCP2515_ReadStatus(void) {
 153:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 154:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 155:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 156:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_READ_STATUS);
 157:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	i = SPI_Read();
 158:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 159:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 160:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return i;
 161:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 162:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 163:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*uint8_t MCP2515_ReadStatus(void) {
 164:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return MCP2515_ReadXXStatus_Helper(MCP_READ_STATUS);
 165:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }*/
 166:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 167:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*uint8_t MCP2515_RxStatus(void) {
 168:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return MCP2515_ReadXXStatus_Helper(MCP_RX_STATUS);
 169:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }*/
 170:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 171:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** uint8_t MCP2515_SetCanCtrl(const uint8_t newmask, const uint8_t newmode) {
 172:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 173:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_ModifyRegister(MCP_CANCTRL, newmask, newmode);
 174:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// verify as advised in datasheet
 175:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	i = MCP2515_ReadRegister(MCP_CANCTRL);
 176:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	i &= newmask;
 177:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if ( i == newmode ) {
 178:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return MCP2515_OK; 
 179:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 180:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	else {
 181:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return MCP2515_FAIL;
 182:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 183:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 184:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 185:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*uint8_t MCP2515_SetClkout(const uint8_t newmode) {
 186:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 187:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_ModifyRegister(MCP_CANCTRL, CLK_MASK, newmode);
 188:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// verify, perhaps not needed?
 189:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	i = MCP2515_ReadRegister(MCP_CANCTRL);
 190:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	i &= CLK_MASK;
 191:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if ( i == newmode ) {
 192:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return MCP2515_OK; 
 193:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 194:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	else {
 195:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return MCP2515_FAIL;
 196:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 197:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }*/
 198:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 199:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** inline void MCP2515_ConfigRate(void) {
 200:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SetRegister(MCP_CNF1, MCP_BITRATE_CFG1);
 201:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SetRegister(MCP_CNF2, MCP_BITRATE_CFG2);
 202:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SetRegister(MCP_CNF3, MCP_BITRATE_CFG3);
 203:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 204:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 205:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /**
 206:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Reads a CAN message from the specified buffer base address in the MCP2515. The message
 207:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * is stored in the following format:
 208:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 209:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+0:
 210:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		| SID10 | SID9  | SID8  | SID7  | SID6  | SID5  | SID4  | SID3  |
 211:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		
 212:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+1:
 213:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		| SID2  | SID1  | SID0  | SRR   | IDE   |       | EID17 | EID16 |
 214:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		
 215:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+2:
 216:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		| EID15 | EID14 | EID13 | EID12 | EID11 | EID10 | EID9  | EID8  |
 217:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		
 218:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+3:
 219:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		| EID7  | EID6  | EID5  | EID4  | EID3  | EID2  | EID1  | EID0  |
 220:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		
 221:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+4:
 222:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		|       |  RTR  |  RB1  |  RB0  | DLC3  | DLC2  | DLC1  | DCL0  |
 223:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		
 224:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		BASE+5 - BASE+12:
 225:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		DATA0 - DATA7
 226:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
 227:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @param buffer_sidh_addr
 228:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		Base address to the RX buffer.
 229:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 230:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @param msg
 231:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		Pointer to the message buffer into which the data should be copied.
 232:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 233:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  */
 234:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_ReadCanMsg(const uint8_t buffer, Can_Message_t* msg) {
 235:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t id[4];
 236:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 237:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 238:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 239:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_READ_RX0 + ((buffer & 0x1) << 2));
 240:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// mcp2515 has auto-increment of address-pointer
 241:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 242:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// read ID
 243:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	for (i=0; i<4; i++) {
 244:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		id[i] = SPI_Read();
 245:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 246:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 247:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// extract SID10-SID0
 248:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint16_t stdid = (((uint16_t)(id[0])) << 3) | (((uint16_t)(id[1] & 0xE0)) >> 5);
 249:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 250:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (id[1] & MCP_TXB_EXIDE_M) {
 251:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// extended message
 252:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		msg->ExtendedFlag = 1;
 253:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// SID10-SID0 are still most significant, so shift them up
 254:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// and make room for 18 extended least significant EID-bits
 255:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		msg->Id = ((uint32_t)stdid) << 18;
 256:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// exctract EID17-EID16
 257:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		msg->Id |= (((uint32_t)(id[1] & 0x03))<<16);
 258:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// extract EID15-EID8
 259:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		msg->Id |= (((uint32_t)id[2])<<8);
 260:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// extract EID7-EID0
 261:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		msg->Id |= ((uint32_t)id[3]);
 262:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 263:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     else {
 264:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	// standard message
 265:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	msg->ExtendedFlag = 0;
 266:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	msg->Id = stdid;
 267:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 268:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     
 269:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     // extract DLC
 270:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t rtrdlc = SPI_Read();
 271:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     msg->DataLength = rtrdlc & 0x0F;
 272:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     if (msg->DataLength > 8) msg->DataLength = 8;	// saturate DLC to guarantee 0-8 range
 273:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     
 274:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     // check RTR flag
 275:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     msg->RemoteFlag = (rtrdlc & 0x40) > 0;
 276:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     
 277:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     // read data
 278:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     for (i=0; i<msg->DataLength; i++) {
 279:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	msg->Data.bytes[i] = SPI_Read();
 280:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 281:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 282:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 283:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 284:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 285:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_SPIWriteCanId(const uint8_t ext, const uint32_t can_id) {
 286:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     uint16_t canid = can_id & 0xFFFF;
 287:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     uint8_t tbufdata[4];
 288:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 289:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     
 290:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (ext) {
 291:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[3] = canid & 0xFF;
 292:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[2] = canid >> 8;
 293:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         canid = can_id >> 16;
 294:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[1] = canid & 0x03;
 295:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[1] += (canid & 0x1C ) << 3;
 296:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[1] |= MCP_TXB_EXIDE_M;
 297:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[0] = canid >> 5;
 298:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 299:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     else {
 300:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[0] = canid >> 3;
 301:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[1] = (canid & 0x07 ) << 5;
 302:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[2] = 0;
 303:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****         tbufdata[3] = 0;
 304:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 305:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     for (i=0; i<4; i++) {
 306:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	SPI_ReadWrite(tbufdata[i]);
 307:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 308:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 309:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 310:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 311:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_WriteCanId(const uint8_t mcp_addr, const uint8_t ext, const uint32_t can_id) {
 312:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SELECT();
 313:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(MCP_WRITE);
 314:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_ReadWrite(mcp_addr);
 315:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SPIWriteCanId(ext, can_id);
 316:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 317:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 318:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 319:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** // Buffer can be 0, 1 or 2
 320:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_WriteCanMsg( const uint8_t buffer, const Can_Message_t* msg) {
 321:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t rtrdlc = msg->DataLength;
 322:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 323:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 324:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP_INT_DISABLE();
 325:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_SELECT();
 326:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     SPI_ReadWrite(MCP_LOAD_TX0 | (buffer << 1));
 327:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_SPIWriteCanId(msg->ExtendedFlag, msg->Id);
 328:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     if (msg->RemoteFlag == 1)  rtrdlc |= MCP_RTR_MASK;  // if RTR set bit in byte
 329:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     SPI_ReadWrite(rtrdlc);
 330:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     //MCP2515_UNSELECT();
 331:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     //MCP_INT_ENABLE();
 332:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 333:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	//MCP_INT_DISABLE();
 334:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****    	//MCP2515_SELECT();
 335:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     for (i=0; i<msg->DataLength; i++) {
 336:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     	SPI_ReadWrite(msg->Data.bytes[i]);
 337:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 338:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****    	MCP2515_UNSELECT();
 339:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP_INT_ENABLE();
 340:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 341:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 342:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 343:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** // Start the transmission from one of the tx buffers.
 344:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** //
 345:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** // Buffer can be 0, 1 or 2
 346:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_StartTransmit(const uint8_t buffer) {
 160               	.LM9:
 161               	/* prologue: frame size=0 */
 162               	/* prologue end (size=0) */
 347:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP_INT_DISABLE();
 164               	.LM10:
 165 0058 E998      		cbi 61-0x20,1
 348:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_SELECT();
 167               	.LM11:
 168 005a 4398      		cbi 40-0x20,3
 349:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     SPI_ReadWrite(MCP_RTS_TX | (1 << buffer));
 170               	.LM12:
 171 005c 21E0      		ldi r18,lo8(1)
 172 005e 30E0      		ldi r19,hi8(1)
 173 0060 02C0      		rjmp 2f
 174 0062 220F      	1:	lsl r18
 175 0064 331F      		rol r19
 176 0066 8A95      	2:	dec r24
 177 0068 E2F7      		brpl 1b
 178 006a 2068      		ori r18,lo8(-128)
 179               	.LBB8:
 180               	.LBB9:
 182               	.LM13:
 183 006c 2EBD      		out 78-0x20,r18
 184               	.L12:
 186               	.LM14:
 187 006e 0DB4      		in __tmp_reg__,77-0x20
 188 0070 07FE      		sbrs __tmp_reg__,7
 189 0072 FDCF      		rjmp .L12
 191               	.LM15:
 192 0074 8EB5      		in r24,78-0x20
 193               	.LBE9:
 194               	.LBE8:
 350:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_UNSELECT();
 196               	.LM16:
 197 0076 439A      		sbi 40-0x20,3
 351:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP_INT_ENABLE();
 199               	.LM17:
 200 0078 E99A      		sbi 61-0x20,1
 201               	/* epilogue: frame size=0 */
 202 007a 0895      		ret
 203               	/* epilogue end (size=1) */
 204               	/* function MCP2515_StartTransmit size 19 (18) */
 206               	.Lscope1:
 210               	.global	MCP2515_SPIWriteCanId
 212               	MCP2515_SPIWriteCanId:
 214               	.LM18:
 215               	/* prologue: frame size=4 */
 216 007c CF93      		push r28
 217 007e DF93      		push r29
 218 0080 CDB7      		in r28,__SP_L__
 219 0082 DEB7      		in r29,__SP_H__
 220 0084 2497      		sbiw r28,4
 221 0086 0FB6      		in __tmp_reg__,__SREG__
 222 0088 F894      		cli
 223 008a DEBF      		out __SP_H__,r29
 224 008c 0FBE      		out __SREG__,__tmp_reg__
 225 008e CDBF      		out __SP_L__,r28
 226               	/* prologue end (size=10) */
 228               	.LM19:
 229 0090 9A01      		movw r18,r20
 231               	.LM20:
 232 0092 8823      		tst r24
 233 0094 C1F0      		breq .L18
 235               	.LM21:
 236 0096 4C83      		std Y+4,r20
 238               	.LM22:
 239 0098 852F      		mov r24,r21
 240 009a 9927      		clr r25
 241 009c 8B83      		std Y+3,r24
 243               	.LM23:
 244 009e CB01      		movw r24,r22
 245 00a0 AA27      		clr r26
 246 00a2 BB27      		clr r27
 248               	.LM24:
 249 00a4 282F      		mov r18,r24
 251               	.LM25:
 252 00a6 382F      		mov r19,r24
 253 00a8 3C71      		andi r19,lo8(28)
 254 00aa 330F      		lsl r19
 255 00ac 330F      		lsl r19
 256 00ae 330F      		lsl r19
 257 00b0 2370      		andi r18,lo8(3)
 258 00b2 230F      		add r18,r19
 259 00b4 2860      		ori r18,lo8(8)
 260 00b6 2A83      		std Y+2,r18
 262               	.LM26:
 263 00b8 45E0      		ldi r20,5
 264 00ba 9695      	1:	lsr r25
 265 00bc 8795      		ror r24
 266 00be 4A95      		dec r20
 267 00c0 E1F7      		brne 1b
 268 00c2 8983      		std Y+1,r24
 269 00c4 0EC0      		rjmp .L20
 270               	.L18:
 272               	.LM27:
 273 00c6 CA01      		movw r24,r20
 274 00c8 33E0      		ldi r19,3
 275 00ca 9695      	1:	lsr r25
 276 00cc 8795      		ror r24
 277 00ce 3A95      		dec r19
 278 00d0 E1F7      		brne 1b
 279 00d2 8983      		std Y+1,r24
 281               	.LM28:
 282 00d4 822F      		mov r24,r18
 283 00d6 8295      		swap r24
 284 00d8 880F      		lsl r24
 285 00da 807E      		andi r24,0xe0
 286 00dc 8A83      		std Y+2,r24
 288               	.LM29:
 289 00de 1B82      		std Y+3,__zero_reg__
 291               	.LM30:
 292 00e0 1C82      		std Y+4,__zero_reg__
 293               	.L20:
 294 00e2 FE01      		movw r30,r28
 295 00e4 3196      		adiw r30,1
 296 00e6 9E01      		movw r18,r28
 297 00e8 2B5F      		subi r18,lo8(-(5))
 298 00ea 3F4F      		sbci r19,hi8(-(5))
 299               	.L21:
 301               	.LM31:
 302 00ec 8081      		ld r24,Z
 303               	.LBB12:
 304               	.LBB13:
 306               	.LM32:
 307 00ee 8EBD      		out 78-0x20,r24
 308               	.L22:
 310               	.LM33:
 311 00f0 0DB4      		in __tmp_reg__,77-0x20
 312 00f2 07FE      		sbrs __tmp_reg__,7
 313 00f4 FDCF      		rjmp .L22
 315               	.LM34:
 316 00f6 8EB5      		in r24,78-0x20
 317 00f8 3196      		adiw r30,1
 318               	.LBE13:
 319               	.LBE12:
 321               	.LM35:
 322 00fa E217      		cp r30,r18
 323 00fc F307      		cpc r31,r19
 324 00fe B1F7      		brne .L21
 325               	/* epilogue: frame size=4 */
 326 0100 2496      		adiw r28,4
 327 0102 0FB6      		in __tmp_reg__,__SREG__
 328 0104 F894      		cli
 329 0106 DEBF      		out __SP_H__,r29
 330 0108 0FBE      		out __SREG__,__tmp_reg__
 331 010a CDBF      		out __SP_L__,r28
 332 010c DF91      		pop r29
 333 010e CF91      		pop r28
 334 0110 0895      		ret
 335               	/* epilogue end (size=9) */
 336               	/* function MCP2515_SPIWriteCanId size 75 (56) */
 342               	.Lscope2:
 346               	.global	MCP2515_WriteCanMsg
 348               	MCP2515_WriteCanMsg:
 350               	.LM36:
 351               	/* prologue: frame size=0 */
 352 0112 1F93      		push r17
 353 0114 CF93      		push r28
 354 0116 DF93      		push r29
 355               	/* prologue end (size=3) */
 356 0118 EB01      		movw r28,r22
 358               	.LM37:
 359 011a 1C81      		ldd r17,Y+4
 361               	.LM38:
 362 011c E998      		cbi 61-0x20,1
 364               	.LM39:
 365 011e 4398      		cbi 40-0x20,3
 367               	.LM40:
 368 0120 880F      		lsl r24
 369 0122 8064      		ori r24,lo8(64)
 370               	.LBB20:
 371               	.LBB21:
 373               	.LM41:
 374 0124 8EBD      		out 78-0x20,r24
 375               	.L31:
 377               	.LM42:
 378 0126 0DB4      		in __tmp_reg__,77-0x20
 379 0128 07FE      		sbrs __tmp_reg__,7
 380 012a FDCF      		rjmp .L31
 382               	.LM43:
 383 012c 8EB5      		in r24,78-0x20
 384               	.LBE21:
 385               	.LBE20:
 387               	.LM44:
 388 012e 4881      		ld r20,Y
 389 0130 5981      		ldd r21,Y+1
 390 0132 6A81      		ldd r22,Y+2
 391 0134 7B81      		ldd r23,Y+3
 392 0136 8D81      		ldd r24,Y+5
 393 0138 0E94 0000 		call MCP2515_SPIWriteCanId
 395               	.LM45:
 396 013c 8E81      		ldd r24,Y+6
 397 013e 8130      		cpi r24,lo8(1)
 398 0140 09F4      		brne .L33
 399 0142 1064      		ori r17,lo8(64)
 400               	.L33:
 401               	.LBB22:
 402               	.LBB23:
 404               	.LM46:
 405 0144 1EBD      		out 78-0x20,r17
 406               	.L35:
 408               	.LM47:
 409 0146 0DB4      		in __tmp_reg__,77-0x20
 410 0148 07FE      		sbrs __tmp_reg__,7
 411 014a FDCF      		rjmp .L35
 413               	.LM48:
 414 014c 8EB5      		in r24,78-0x20
 415               	.LBE23:
 416               	.LBE22:
 418               	.LM49:
 419 014e 2C81      		ldd r18,Y+4
 420 0150 90E0      		ldi r25,lo8(0)
 421 0152 0AC0      		rjmp .L37
 422               	.L38:
 424               	.LM50:
 425 0154 FE01      		movw r30,r28
 426 0156 E90F      		add r30,r25
 427 0158 F11D      		adc r31,__zero_reg__
 428 015a 8781      		ldd r24,Z+7
 429               	.LBB24:
 430               	.LBB25:
 432               	.LM51:
 433 015c 8EBD      		out 78-0x20,r24
 434               	.L39:
 436               	.LM52:
 437 015e 0DB4      		in __tmp_reg__,77-0x20
 438 0160 07FE      		sbrs __tmp_reg__,7
 439 0162 FDCF      		rjmp .L39
 441               	.LM53:
 442 0164 8EB5      		in r24,78-0x20
 443               	.LBE25:
 444               	.LBE24:
 446               	.LM54:
 447 0166 9F5F      		subi r25,lo8(-(1))
 448               	.L37:
 449 0168 9217      		cp r25,r18
 450 016a A1F7      		brne .L38
 452               	.LM55:
 453 016c 439A      		sbi 40-0x20,3
 455               	.LM56:
 456 016e E99A      		sbi 61-0x20,1
 457               	/* epilogue: frame size=0 */
 458 0170 DF91      		pop r29
 459 0172 CF91      		pop r28
 460 0174 1F91      		pop r17
 461 0176 0895      		ret
 462               	/* epilogue end (size=4) */
 463               	/* function MCP2515_WriteCanMsg size 51 (44) */
 469               	.Lscope3:
 474               	.global	MCP2515_WriteCanId
 476               	MCP2515_WriteCanId:
 478               	.LM57:
 479               	/* prologue: frame size=0 */
 480               	/* prologue end (size=0) */
 481 0178 982F      		mov r25,r24
 482 017a E62F      		mov r30,r22
 484               	.LM58:
 485 017c 4398      		cbi 40-0x20,3
 486               	.LBB30:
 487               	.LBB31:
 489               	.LM59:
 490 017e 82E0      		ldi r24,lo8(2)
 491 0180 8EBD      		out 78-0x20,r24
 492               	.L50:
 494               	.LM60:
 495 0182 0DB4      		in __tmp_reg__,77-0x20
 496 0184 07FE      		sbrs __tmp_reg__,7
 497 0186 FDCF      		rjmp .L50
 499               	.LM61:
 500 0188 8EB5      		in r24,78-0x20
 501               	.LBE31:
 502               	.LBE30:
 503               	.LBB32:
 504               	.LBB33:
 506               	.LM62:
 507 018a 9EBD      		out 78-0x20,r25
 508               	.L52:
 510               	.LM63:
 511 018c 0DB4      		in __tmp_reg__,77-0x20
 512 018e 07FE      		sbrs __tmp_reg__,7
 513 0190 FDCF      		rjmp .L52
 515               	.LM64:
 516 0192 8EB5      		in r24,78-0x20
 517               	.LBE33:
 518               	.LBE32:
 520               	.LM65:
 521 0194 BA01      		movw r22,r20
 522 0196 A901      		movw r20,r18
 523 0198 8E2F      		mov r24,r30
 524 019a 0E94 0000 		call MCP2515_SPIWriteCanId
 526               	.LM66:
 527 019e 439A      		sbi 40-0x20,3
 528               	/* epilogue: frame size=0 */
 529 01a0 0895      		ret
 530               	/* epilogue end (size=1) */
 531               	/* function MCP2515_WriteCanId size 21 (20) */
 533               	.Lscope4:
 536               	.global	MCP2515_ReadRegister
 538               	MCP2515_ReadRegister:
 540               	.LM67:
 541               	/* prologue: frame size=0 */
 542               	/* prologue end (size=0) */
 543 01a2 982F      		mov r25,r24
 545               	.LM68:
 546 01a4 4398      		cbi 40-0x20,3
 547               	.LBB42:
 548               	.LBB43:
 550               	.LM69:
 551 01a6 83E0      		ldi r24,lo8(3)
 552 01a8 8EBD      		out 78-0x20,r24
 553               	.L60:
 555               	.LM70:
 556 01aa 0DB4      		in __tmp_reg__,77-0x20
 557 01ac 07FE      		sbrs __tmp_reg__,7
 558 01ae FDCF      		rjmp .L60
 560               	.LM71:
 561 01b0 8EB5      		in r24,78-0x20
 562               	.LBE43:
 563               	.LBE42:
 564               	.LBB44:
 565               	.LBB45:
 567               	.LM72:
 568 01b2 9EBD      		out 78-0x20,r25
 569               	.L62:
 571               	.LM73:
 572 01b4 0DB4      		in __tmp_reg__,77-0x20
 573 01b6 07FE      		sbrs __tmp_reg__,7
 574 01b8 FDCF      		rjmp .L62
 576               	.LM74:
 577 01ba 8EB5      		in r24,78-0x20
 578               	.LBE45:
 579               	.LBE44:
 580               	.LBB46:
 581               	.LBB47:
 582               	.LBB48:
 583               	.LBB49:
 585               	.LM75:
 586 01bc 1EBC      		out 78-0x20,__zero_reg__
 587               	.L64:
 589               	.LM76:
 590 01be 0DB4      		in __tmp_reg__,77-0x20
 591 01c0 07FE      		sbrs __tmp_reg__,7
 592 01c2 FDCF      		rjmp .L64
 594               	.LM77:
 595 01c4 8EB5      		in r24,78-0x20
 596               	.LBE49:
 597               	.LBE48:
 598               	.LBE47:
 599               	.LBE46:
 601               	.LM78:
 602 01c6 439A      		sbi 40-0x20,3
 604               	.LM79:
 605 01c8 9927      		clr r25
 606               	/* epilogue: frame size=0 */
 607 01ca 0895      		ret
 608               	/* epilogue end (size=1) */
 609               	/* function MCP2515_ReadRegister size 21 (20) */
 611               	.Lscope5:
 615               	.global	MCP2515_SetRegister
 617               	MCP2515_SetRegister:
 619               	.LM80:
 620               	/* prologue: frame size=0 */
 621               	/* prologue end (size=0) */
 622 01cc 982F      		mov r25,r24
 624               	.LM81:
 625 01ce 4398      		cbi 40-0x20,3
 626               	.LBB56:
 627               	.LBB57:
 629               	.LM82:
 630 01d0 82E0      		ldi r24,lo8(2)
 631 01d2 8EBD      		out 78-0x20,r24
 632               	.L74:
 634               	.LM83:
 635 01d4 0DB4      		in __tmp_reg__,77-0x20
 636 01d6 07FE      		sbrs __tmp_reg__,7
 637 01d8 FDCF      		rjmp .L74
 639               	.LM84:
 640 01da 8EB5      		in r24,78-0x20
 641               	.LBE57:
 642               	.LBE56:
 643               	.LBB58:
 644               	.LBB59:
 646               	.LM85:
 647 01dc 9EBD      		out 78-0x20,r25
 648               	.L76:
 650               	.LM86:
 651 01de 0DB4      		in __tmp_reg__,77-0x20
 652 01e0 07FE      		sbrs __tmp_reg__,7
 653 01e2 FDCF      		rjmp .L76
 655               	.LM87:
 656 01e4 8EB5      		in r24,78-0x20
 657               	.LBE59:
 658               	.LBE58:
 659               	.LBB60:
 660               	.LBB61:
 662               	.LM88:
 663 01e6 6EBD      		out 78-0x20,r22
 664               	.L78:
 666               	.LM89:
 667 01e8 0DB4      		in __tmp_reg__,77-0x20
 668 01ea 07FE      		sbrs __tmp_reg__,7
 669 01ec FDCF      		rjmp .L78
 671               	.LM90:
 672 01ee 8EB5      		in r24,78-0x20
 673               	.LBE61:
 674               	.LBE60:
 676               	.LM91:
 677 01f0 439A      		sbi 40-0x20,3
 678               	/* epilogue: frame size=0 */
 679 01f2 0895      		ret
 680               	/* epilogue end (size=1) */
 681               	/* function MCP2515_SetRegister size 20 (19) */
 683               	.Lscope6:
 685               	.global	MCP2515_InitRXInterrupts
 687               	MCP2515_InitRXInterrupts:
 352:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 353:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 354:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** uint8_t MCP2515_GetNextFreeTXBuf(void) {
 355:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t stat;
 356:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 357:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// check all 3 TX-Buffers
 358:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP_INT_DISABLE();
 359:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	stat = MCP2515_ReadStatus();
 360:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP_INT_ENABLE();
 361:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (!(stat & MCP_STAT_TX0REQ)) return 0;
 362:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (!(stat & MCP_STAT_TX1REQ)) return 1;
 363:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (!(stat & MCP_STAT_TX2REQ)) return 2;
 364:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return MCP_ALLTXBUSY;
 365:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 366:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 367:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_InitCanBuffers(void) {
 368:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t i;
 369:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 370:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// TODO: check why this is needed to receive extended 
 371:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	//   and standard frames
 372:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// Mark all filter bits as don't care:
 373:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXM0SIDH, 0, 0);
 374:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXM1SIDH, 0, 0);
 375:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     // Anyway, set all filters to 0:
 376:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF0SIDH, 1, 0); // RXB0: extended 
 377:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF1SIDH, 0, 0); //       AND standard
 378:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF2SIDH, 1, 0); // RXB1: extended 
 379:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF3SIDH, 0, 0); //       AND standard
 380:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF4SIDH, 0, 0);
 381:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_WriteCanId(MCP_RXF5SIDH, 0, 0);
 382:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 383:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// Clear, deactivate the three transmit buffers
 384:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// TXBnCTRL -> TXBnD7
 385:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     for (i = 0; i < 14; i++) { // in-buffer loop
 386:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_SetRegister(MCP_TXB0CTRL + i, 0);
 387:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_SetRegister(MCP_TXB1CTRL + i, 0);
 388:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_SetRegister(MCP_TXB2CTRL + i, 0);
 389:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     }
 390:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 391:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     // and clear, deactivate the two receive buffers.
 392:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_SetRegister(MCP_RXB0CTRL, 0);
 393:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****     MCP2515_SetRegister(MCP_RXB1CTRL, 0);
 394:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 395:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 396:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 397:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** void MCP2515_InitRXInterrupts(void) {
 689               	.LM92:
 690               	/* prologue: frame size=0 */
 691               	/* prologue end (size=0) */
 398:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SetRegister(MCP_CANINTF, 0);
 693               	.LM93:
 694 01f4 60E0      		ldi r22,lo8(0)
 695 01f6 8CE2      		ldi r24,lo8(44)
 696 01f8 0E94 0000 		call MCP2515_SetRegister
 399:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_SetRegister(MCP_CANINTE, MCP_RX_INT);
 698               	.LM94:
 699 01fc 63E0      		ldi r22,lo8(3)
 700 01fe 8BE2      		ldi r24,lo8(43)
 701 0200 0E94 0000 		call MCP2515_SetRegister
 400:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP_INT_ENABLE();
 703               	.LM95:
 704 0204 E99A      		sbi 61-0x20,1
 705               	/* epilogue: frame size=0 */
 706 0206 0895      		ret
 707               	/* epilogue end (size=1) */
 708               	/* function MCP2515_InitRXInterrupts size 10 (9) */
 710               	.Lscope7:
 712               	.global	MCP2515_InitCanBuffers
 714               	MCP2515_InitCanBuffers:
 716               	.LM96:
 717               	/* prologue: frame size=0 */
 718 0208 1F93      		push r17
 719 020a CF93      		push r28
 720 020c DF93      		push r29
 721               	/* prologue end (size=3) */
 723               	.LM97:
 724 020e 20E0      		ldi r18,lo8(0)
 725 0210 30E0      		ldi r19,hi8(0)
 726 0212 40E0      		ldi r20,hlo8(0)
 727 0214 50E0      		ldi r21,hhi8(0)
 728 0216 60E0      		ldi r22,lo8(0)
 729 0218 80E2      		ldi r24,lo8(32)
 730 021a 0E94 0000 		call MCP2515_WriteCanId
 732               	.LM98:
 733 021e 20E0      		ldi r18,lo8(0)
 734 0220 30E0      		ldi r19,hi8(0)
 735 0222 40E0      		ldi r20,hlo8(0)
 736 0224 50E0      		ldi r21,hhi8(0)
 737 0226 60E0      		ldi r22,lo8(0)
 738 0228 84E2      		ldi r24,lo8(36)
 739 022a 0E94 0000 		call MCP2515_WriteCanId
 741               	.LM99:
 742 022e 20E0      		ldi r18,lo8(0)
 743 0230 30E0      		ldi r19,hi8(0)
 744 0232 40E0      		ldi r20,hlo8(0)
 745 0234 50E0      		ldi r21,hhi8(0)
 746 0236 61E0      		ldi r22,lo8(1)
 747 0238 80E0      		ldi r24,lo8(0)
 748 023a 0E94 0000 		call MCP2515_WriteCanId
 750               	.LM100:
 751 023e 20E0      		ldi r18,lo8(0)
 752 0240 30E0      		ldi r19,hi8(0)
 753 0242 40E0      		ldi r20,hlo8(0)
 754 0244 50E0      		ldi r21,hhi8(0)
 755 0246 60E0      		ldi r22,lo8(0)
 756 0248 84E0      		ldi r24,lo8(4)
 757 024a 0E94 0000 		call MCP2515_WriteCanId
 759               	.LM101:
 760 024e 20E0      		ldi r18,lo8(0)
 761 0250 30E0      		ldi r19,hi8(0)
 762 0252 40E0      		ldi r20,hlo8(0)
 763 0254 50E0      		ldi r21,hhi8(0)
 764 0256 61E0      		ldi r22,lo8(1)
 765 0258 88E0      		ldi r24,lo8(8)
 766 025a 0E94 0000 		call MCP2515_WriteCanId
 768               	.LM102:
 769 025e 20E0      		ldi r18,lo8(0)
 770 0260 30E0      		ldi r19,hi8(0)
 771 0262 40E0      		ldi r20,hlo8(0)
 772 0264 50E0      		ldi r21,hhi8(0)
 773 0266 60E0      		ldi r22,lo8(0)
 774 0268 80E1      		ldi r24,lo8(16)
 775 026a 0E94 0000 		call MCP2515_WriteCanId
 777               	.LM103:
 778 026e 20E0      		ldi r18,lo8(0)
 779 0270 30E0      		ldi r19,hi8(0)
 780 0272 40E0      		ldi r20,hlo8(0)
 781 0274 50E0      		ldi r21,hhi8(0)
 782 0276 60E0      		ldi r22,lo8(0)
 783 0278 84E1      		ldi r24,lo8(20)
 784 027a 0E94 0000 		call MCP2515_WriteCanId
 786               	.LM104:
 787 027e 20E0      		ldi r18,lo8(0)
 788 0280 30E0      		ldi r19,hi8(0)
 789 0282 40E0      		ldi r20,hlo8(0)
 790 0284 50E0      		ldi r21,hhi8(0)
 791 0286 60E0      		ldi r22,lo8(0)
 792 0288 88E1      		ldi r24,lo8(24)
 793 028a 0E94 0000 		call MCP2515_WriteCanId
 794 028e C0E0      		ldi r28,lo8(0)
 795 0290 D0E0      		ldi r29,hi8(0)
 796               	.L90:
 798               	.LM105:
 799 0292 60E0      		ldi r22,lo8(0)
 800 0294 8C2F      		mov r24,r28
 801 0296 805D      		subi r24,lo8(-(48))
 802 0298 0E94 0000 		call MCP2515_SetRegister
 804               	.LM106:
 805 029c 60E0      		ldi r22,lo8(0)
 806 029e 8C2F      		mov r24,r28
 807 02a0 805C      		subi r24,lo8(-(64))
 808 02a2 0E94 0000 		call MCP2515_SetRegister
 810               	.LM107:
 811 02a6 60E0      		ldi r22,lo8(0)
 812 02a8 8C2F      		mov r24,r28
 813 02aa 805B      		subi r24,lo8(-(80))
 814 02ac 0E94 0000 		call MCP2515_SetRegister
 815 02b0 2196      		adiw r28,1
 817               	.LM108:
 818 02b2 CE30      		cpi r28,14
 819 02b4 D105      		cpc r29,__zero_reg__
 820 02b6 69F7      		brne .L90
 822               	.LM109:
 823 02b8 60E0      		ldi r22,lo8(0)
 824 02ba 80E6      		ldi r24,lo8(96)
 825 02bc 0E94 0000 		call MCP2515_SetRegister
 827               	.LM110:
 828 02c0 60E0      		ldi r22,lo8(0)
 829 02c2 80E7      		ldi r24,lo8(112)
 830 02c4 0E94 0000 		call MCP2515_SetRegister
 831               	/* epilogue: frame size=0 */
 832 02c8 DF91      		pop r29
 833 02ca CF91      		pop r28
 834 02cc 1F91      		pop r17
 835 02ce 0895      		ret
 836               	/* epilogue end (size=4) */
 837               	/* function MCP2515_InitCanBuffers size 100 (93) */
 839               	.Lscope8:
 841               	.global	MCP2515_ConfigRate
 843               	MCP2515_ConfigRate:
 845               	.LM111:
 846               	/* prologue: frame size=0 */
 847               	/* prologue end (size=0) */
 849               	.LM112:
 850 02d0 61E0      		ldi r22,lo8(1)
 851 02d2 8AE2      		ldi r24,lo8(42)
 852 02d4 0E94 0000 		call MCP2515_SetRegister
 854               	.LM113:
 855 02d8 66EB      		ldi r22,lo8(-74)
 856 02da 89E2      		ldi r24,lo8(41)
 857 02dc 0E94 0000 		call MCP2515_SetRegister
 859               	.LM114:
 860 02e0 64E0      		ldi r22,lo8(4)
 861 02e2 88E2      		ldi r24,lo8(40)
 862 02e4 0E94 0000 		call MCP2515_SetRegister
 863               	/* epilogue: frame size=0 */
 864 02e8 0895      		ret
 865               	/* epilogue end (size=1) */
 866               	/* function MCP2515_ConfigRate size 13 (12) */
 868               	.Lscope9:
 873               	.global	MCP2515_ModifyRegister
 875               	MCP2515_ModifyRegister:
 877               	.LM115:
 878               	/* prologue: frame size=0 */
 879               	/* prologue end (size=0) */
 880 02ea 982F      		mov r25,r24
 882               	.LM116:
 883 02ec 4398      		cbi 40-0x20,3
 884               	.LBB70:
 885               	.LBB71:
 887               	.LM117:
 888 02ee 85E0      		ldi r24,lo8(5)
 889 02f0 8EBD      		out 78-0x20,r24
 890               	.L98:
 892               	.LM118:
 893 02f2 0DB4      		in __tmp_reg__,77-0x20
 894 02f4 07FE      		sbrs __tmp_reg__,7
 895 02f6 FDCF      		rjmp .L98
 897               	.LM119:
 898 02f8 8EB5      		in r24,78-0x20
 899               	.LBE71:
 900               	.LBE70:
 901               	.LBB72:
 902               	.LBB73:
 904               	.LM120:
 905 02fa 9EBD      		out 78-0x20,r25
 906               	.L100:
 908               	.LM121:
 909 02fc 0DB4      		in __tmp_reg__,77-0x20
 910 02fe 07FE      		sbrs __tmp_reg__,7
 911 0300 FDCF      		rjmp .L100
 913               	.LM122:
 914 0302 8EB5      		in r24,78-0x20
 915               	.LBE73:
 916               	.LBE72:
 917               	.LBB74:
 918               	.LBB75:
 920               	.LM123:
 921 0304 6EBD      		out 78-0x20,r22
 922               	.L102:
 924               	.LM124:
 925 0306 0DB4      		in __tmp_reg__,77-0x20
 926 0308 07FE      		sbrs __tmp_reg__,7
 927 030a FDCF      		rjmp .L102
 929               	.LM125:
 930 030c 8EB5      		in r24,78-0x20
 931               	.LBE75:
 932               	.LBE74:
 933               	.LBB76:
 934               	.LBB77:
 936               	.LM126:
 937 030e 4EBD      		out 78-0x20,r20
 938               	.L104:
 940               	.LM127:
 941 0310 0DB4      		in __tmp_reg__,77-0x20
 942 0312 07FE      		sbrs __tmp_reg__,7
 943 0314 FDCF      		rjmp .L104
 945               	.LM128:
 946 0316 8EB5      		in r24,78-0x20
 947               	.LBE77:
 948               	.LBE76:
 950               	.LM129:
 951 0318 439A      		sbi 40-0x20,3
 952               	/* epilogue: frame size=0 */
 953 031a 0895      		ret
 954               	/* epilogue end (size=1) */
 955               	/* function MCP2515_ModifyRegister size 25 (24) */
 957               	.Lscope10:
 961               	.global	MCP2515_SetCanCtrl
 963               	MCP2515_SetCanCtrl:
 965               	.LM130:
 966               	/* prologue: frame size=0 */
 967 031c 0F93      		push r16
 968 031e 1F93      		push r17
 969               	/* prologue end (size=2) */
 970 0320 182F      		mov r17,r24
 971 0322 062F      		mov r16,r22
 973               	.LM131:
 974 0324 462F      		mov r20,r22
 975 0326 682F      		mov r22,r24
 976 0328 8FE0      		ldi r24,lo8(15)
 977 032a 0E94 0000 		call MCP2515_ModifyRegister
 979               	.LM132:
 980 032e 8FE0      		ldi r24,lo8(15)
 981 0330 0E94 0000 		call MCP2515_ReadRegister
 982 0334 90E0      		ldi r25,lo8(0)
 983 0336 1823      		and r17,r24
 984 0338 1017      		cp r17,r16
 985 033a 09F4      		brne .L116
 987               	.LM133:
 988 033c 91E0      		ldi r25,lo8(1)
 989               	.L116:
 990 033e 81E0      		ldi r24,lo8(1)
 991 0340 9827      		eor r25,r24
 993               	.LM134:
 994 0342 892F      		mov r24,r25
 995 0344 9927      		clr r25
 996               	/* epilogue: frame size=0 */
 997 0346 1F91      		pop r17
 998 0348 0F91      		pop r16
 999 034a 0895      		ret
 1000               	/* epilogue end (size=3) */
 1001               	/* function MCP2515_SetCanCtrl size 24 (19) */
 1003               	.Lscope11:
 1005               	.global	MCP2515_Init
 1007               	MCP2515_Init:
 401:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 402:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 403:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** // ---
 404:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 405:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** uint8_t MCP2515_Init(void) {
 1009               	.LM135:
 1010               	/* prologue: frame size=0 */
 1011 034c 1F93      		push r17
 1012               	/* prologue end (size=1) */
 406:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t res;
 407:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 408:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #if MCP_CS_BIT != SS
 409:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	/* If slave select is not set as output it might change SPI hw to slave
 410:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	 * See ch 18.3.2 (18.3 SS Pin Functionality) in ATmega48/88/168-datasheet */
 411:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	DDRSS |= (1<<SS);
 1014               	.LM136:
 1015 034e 229A      		sbi 36-0x20,2
 1016               	.LBB80:
 1017               	.LBB81:
 1019               	.LM137:
 1020 0350 84B1      		in r24,36-0x20
 1021 0352 8862      		ori r24,lo8(40)
 1022 0354 84B9      		out 36-0x20,r24
 1024               	.LM138:
 1025 0356 2498      		cbi 36-0x20,4
 1027               	.LM139:
 1028 0358 80E5      		ldi r24,lo8(80)
 1029 035a 8CBD      		out 76-0x20,r24
 1031               	.LM140:
 1032 035c 81E0      		ldi r24,lo8(1)
 1033 035e 8DBD      		out 77-0x20,r24
 1034               	.LBE81:
 1035               	.LBE80:
 412:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #endif
 413:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 414:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	SPI_Init();		// init SPI-Interface (as "Master")
 415:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 416:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_UNSELECT();
 1037               	.LM141:
 1038 0360 439A      		sbi 40-0x20,3
 417:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP_CS_DDR |= ( 1 << MCP_CS_BIT );
 1040               	.LM142:
 1041 0362 3B9A      		sbi 39-0x20,3
 418:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 419:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_Reset();
 1043               	.LM143:
 1044 0364 0E94 0000 		call MCP2515_Reset
 420:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 421:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	res = MCP2515_SetCanCtrl(MODE_MASK, MODE_CONFIG);
 1046               	.LM144:
 1047 0368 60E8      		ldi r22,lo8(-128)
 1048 036a 80EE      		ldi r24,lo8(-32)
 1049 036c 0E94 0000 		call MCP2515_SetCanCtrl
 422:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 423:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (res == MCP2515_FAIL) return res;  /* function exit on error */
 1051               	.LM145:
 1052 0370 8130      		cpi r24,lo8(1)
 1053 0372 D1F0      		breq .L119
 424:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 425:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	/* Set prescaler for clock output */
 426:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	res = MCP2515_SetCanCtrl(CLK_MASK, MCP_PRESCALER);
 1055               	.LM146:
 1056 0374 60E0      		ldi r22,lo8(0)
 1057 0376 83E0      		ldi r24,lo8(3)
 1058 0378 0E94 0000 		call MCP2515_SetCanCtrl
 1059 037c 182F      		mov r17,r24
 427:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 428:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (res == MCP2515_FAIL) return res;  /* function exit on error */
 1061               	.LM147:
 1062 037e 8130      		cpi r24,lo8(1)
 1063 0380 99F0      		breq .L119
 429:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 430:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_ConfigRate();
 1065               	.LM148:
 1066 0382 0E94 0000 		call MCP2515_ConfigRate
 431:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 432:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_InitCanBuffers();
 1068               	.LM149:
 1069 0386 0E94 0000 		call MCP2515_InitCanBuffers
 433:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 434:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #if (DEBUG_RXANY==1)
 435:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	#warning DEBUG_RXANY is defined! Bypassing filter.
 436:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// enable both receive-buffers to receive any message
 437:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// and enable rollover
 438:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ModifyRegister(
 439:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB0CTRL,
 440:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_MASK | MCP_RXB_BUKT_MASK,
 441:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_ANY | MCP_RXB_BUKT_MASK);
 442:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ModifyRegister(
 443:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB1CTRL,
 444:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_MASK,
 445:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_ANY);
 446:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #else
 447:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// enable both receive-buffers to receive messages
 448:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// with std. and ext. identifiers
 449:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// and enable rollover
 450:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ModifyRegister(
 1071               	.LM150:
 1072 038a 44E0      		ldi r20,lo8(4)
 1073 038c 64E6      		ldi r22,lo8(100)
 1074 038e 80E6      		ldi r24,lo8(96)
 1075 0390 0E94 0000 		call MCP2515_ModifyRegister
 451:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB0CTRL,
 452:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_MASK | MCP_RXB_BUKT_MASK, 
 453:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_STDEXT | MCP_RXB_BUKT_MASK );
 454:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ModifyRegister(
 1077               	.LM151:
 1078 0394 40E0      		ldi r20,lo8(0)
 1079 0396 60E6      		ldi r22,lo8(96)
 1080 0398 80E7      		ldi r24,lo8(112)
 1081 039a 0E94 0000 		call MCP2515_ModifyRegister
 455:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB1CTRL,
 456:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_MASK,
 457:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 				MCP_RXB_RX_STDEXT);
 458:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** #endif
 459:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 460:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	MCP2515_InitRXInterrupts();
 1083               	.LM152:
 1084 039e 0E94 0000 		call MCP2515_InitRXInterrupts
 461:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 462:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return res;
 1086               	.LM153:
 1087 03a2 812F      		mov r24,r17
 1088 03a4 9927      		clr r25
 1089 03a6 02C0      		rjmp .L122
 1090               	.L119:
 1091 03a8 81E0      		ldi r24,lo8(1)
 1092 03aa 90E0      		ldi r25,hi8(1)
 1093               	.L122:
 1094               	/* epilogue: frame size=0 */
 1095 03ac 1F91      		pop r17
 1096 03ae 0895      		ret
 1097               	/* epilogue end (size=2) */
 1098               	/* function MCP2515_Init size 50 (47) */
 1100               	.Lscope12:
 1102               	.global	Can_Init
 1104               	Can_Init:
 463:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 464:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 465:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** Can_Return_t Can_Receive(Can_Message_t *msg);
 466:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 467:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** ISR(MCP_INT_VECTOR) {
 468:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// Get first available message from controller and pass it to
 469:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// application handler. If both RX buffers contain messages
 470:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	// we will get another interrupt as soon as this one returns.
 471:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (Can_Receive(&msgbuf) == CAN_OK) {
 472:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// Callbacks are run with global interrupts disabled but
 473:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// with controller flag cleared so another msg can be
 474:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// received while this one is processed.
 475:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		Can_Process(&msgbuf);
 476:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	}
 477:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 478:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 479:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /*-----------------------------------------------------------------------------
 480:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Public Functions
 481:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *---------------------------------------------------------------------------*/
 482:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 483:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /**
 484:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Initializes the CAN interface. Edit can_cfg.h to choose bitrate.
 485:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 486:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @return
 487:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		CAN_OK if initialization was successful.
 488:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		CAN_INIT_FAIL_SET_BITRATE if bitrate could not be set correctly.
 489:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		CAN_INIT_FAIL_SET_MODE if the controller could not be set to normal operation mode.
 490:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 		CAN_INIT_FAIL in case of general error.
 491:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  */
 492:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** Can_Return_t Can_Init(void) {
 1106               	.LM154:
 1107               	/* prologue: frame size=0 */
 1108               	/* prologue end (size=0) */
 493:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		/*
 494:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		 * Initialize MCP2515 device.
 495:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		 */
 496:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		if (MCP2515_Init() != MCP2515_OK) {
 1110               	.LM155:
 1111 03b0 0E94 0000 		call MCP2515_Init
 1112 03b4 8823      		tst r24
 1113 03b6 49F4      		brne .L125
 497:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 			return CAN_FAIL;
 498:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		}
 499:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		if (MCP2515_SetCanCtrl(MODE_MASK, MODE_NORMAL) != MCP2515_OK) {
 1115               	.LM156:
 1116 03b8 60E0      		ldi r22,lo8(0)
 1117 03ba 80EE      		ldi r24,lo8(-32)
 1118 03bc 0E94 0000 		call MCP2515_SetCanCtrl
 1119 03c0 8823      		tst r24
 1120 03c2 19F4      		brne .L125
 1121 03c4 81E0      		ldi r24,lo8(1)
 1122 03c6 90E0      		ldi r25,hi8(1)
 1123 03c8 0895      		ret
 1124               	.L125:
 1125 03ca 8FEF      		ldi r24,lo8(-1)
 1126 03cc 9FEF      		ldi r25,hi8(-1)
 500:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 			return CAN_FAIL;
 501:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		}
 502:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return CAN_OK;
 503:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 504:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	return CAN_FAIL;
 505:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 1128               	.LM157:
 1129 03ce 0895      		ret
 1130               	/* epilogue: frame size=0 */
 1131               	/* epilogue: noreturn */
 1132               	/* epilogue end (size=0) */
 1133               	/* function Can_Init size 16 (16) */
 1135               	.Lscope13:
 1139               	.global	MCP2515_ReadCanMsg
 1141               	MCP2515_ReadCanMsg:
 1143               	.LM158:
 1144               	/* prologue: frame size=4 */
 1145 03d0 EF92      		push r14
 1146 03d2 FF92      		push r15
 1147 03d4 0F93      		push r16
 1148 03d6 1F93      		push r17
 1149 03d8 CF93      		push r28
 1150 03da DF93      		push r29
 1151 03dc CDB7      		in r28,__SP_L__
 1152 03de DEB7      		in r29,__SP_H__
 1153 03e0 2497      		sbiw r28,4
 1154 03e2 0FB6      		in __tmp_reg__,__SREG__
 1155 03e4 F894      		cli
 1156 03e6 DEBF      		out __SP_H__,r29
 1157 03e8 0FBE      		out __SREG__,__tmp_reg__
 1158 03ea CDBF      		out __SP_L__,r28
 1159               	/* prologue end (size=14) */
 1161               	.LM159:
 1162 03ec 4398      		cbi 40-0x20,3
 1164               	.LM160:
 1165 03ee 8170      		andi r24,lo8(1)
 1166 03f0 880F      		lsl r24
 1167 03f2 880F      		lsl r24
 1168 03f4 8057      		subi r24,lo8(-(-112))
 1169               	.LBB96:
 1170               	.LBB97:
 1172               	.LM161:
 1173 03f6 8EBD      		out 78-0x20,r24
 1174               	.L131:
 1176               	.LM162:
 1177 03f8 0DB4      		in __tmp_reg__,77-0x20
 1178 03fa 07FE      		sbrs __tmp_reg__,7
 1179 03fc FDCF      		rjmp .L131
 1181               	.LM163:
 1182 03fe 8EB5      		in r24,78-0x20
 1183 0400 FE01      		movw r30,r28
 1184 0402 3196      		adiw r30,1
 1185 0404 9E01      		movw r18,r28
 1186 0406 2B5F      		subi r18,lo8(-(5))
 1187 0408 3F4F      		sbci r19,hi8(-(5))
 1188               	.L133:
 1189               	.LBE97:
 1190               	.LBE96:
 1191               	.LBB98:
 1192               	.LBB99:
 1193               	.LBB100:
 1194               	.LBB101:
 1196               	.LM164:
 1197 040a 1EBC      		out 78-0x20,__zero_reg__
 1198               	.L134:
 1200               	.LM165:
 1201 040c 0DB4      		in __tmp_reg__,77-0x20
 1202 040e 07FE      		sbrs __tmp_reg__,7
 1203 0410 FDCF      		rjmp .L134
 1205               	.LM166:
 1206 0412 8EB5      		in r24,78-0x20
 1207               	.LBE101:
 1208               	.LBE100:
 1209               	.LBE99:
 1210               	.LBE98:
 1212               	.LM167:
 1213 0414 8193      		st Z+,r24
 1215               	.LM168:
 1216 0416 E217      		cp r30,r18
 1217 0418 F307      		cpc r31,r19
 1218 041a B9F7      		brne .L133
 1220               	.LM169:
 1221 041c AA81      		ldd r26,Y+2
 1222 041e 8981      		ldd r24,Y+1
 1223 0420 9927      		clr r25
 1224 0422 E3E0      		ldi r30,3
 1225 0424 880F      	1:	lsl r24
 1226 0426 991F      		rol r25
 1227 0428 EA95      		dec r30
 1228 042a E1F7      		brne 1b
 1229 042c 4A2F      		mov r20,r26
 1230 042e 5527      		clr r21
 1231 0430 9A01      		movw r18,r20
 1232 0432 55E0      		ldi r21,5
 1233 0434 3695      	1:	lsr r19
 1234 0436 2795      		ror r18
 1235 0438 5A95      		dec r21
 1236 043a E1F7      		brne 1b
 1237 043c 822B      		or r24,r18
 1238 043e 932B      		or r25,r19
 1239 0440 7C01      		movw r14,r24
 1240 0442 0027      		clr r16
 1241 0444 1127      		clr r17
 1243               	.LM170:
 1244 0446 43FF      		sbrs r20,3
 1245 0448 2EC0      		rjmp .L137
 1247               	.LM171:
 1248 044a 81E0      		ldi r24,lo8(1)
 1249 044c FB01      		movw r30,r22
 1250 044e 8583      		std Z+5,r24
 1252               	.LM172:
 1253 0450 92E1      		ldi r25,18
 1254 0452 EE0C      	1:	lsl r14
 1255 0454 FF1C      		rol r15
 1256 0456 001F      		rol r16
 1257 0458 111F      		rol r17
 1258 045a 9A95      		dec r25
 1259 045c D1F7      		brne 1b
 1261               	.LM173:
 1262 045e 2B81      		ldd r18,Y+3
 1263 0460 3327      		clr r19
 1264 0462 4427      		clr r20
 1265 0464 5527      		clr r21
 1266 0466 542F      		mov r21,r20
 1267 0468 432F      		mov r20,r19
 1268 046a 322F      		mov r19,r18
 1269 046c 2227      		clr r18
 1270 046e 8A2F      		mov r24,r26
 1271 0470 9927      		clr r25
 1272 0472 AA27      		clr r26
 1273 0474 BB27      		clr r27
 1274 0476 8370      		andi r24,lo8(3)
 1275 0478 9070      		andi r25,hi8(3)
 1276 047a A070      		andi r26,hlo8(3)
 1277 047c B070      		andi r27,hhi8(3)
 1278 047e DC01      		movw r26,r24
 1279 0480 9927      		clr r25
 1280 0482 8827      		clr r24
 1281 0484 282B      		or r18,r24
 1282 0486 392B      		or r19,r25
 1283 0488 4A2B      		or r20,r26
 1284 048a 5B2B      		or r21,r27
 1286               	.LM174:
 1287 048c E22A      		or r14,r18
 1288 048e F32A      		or r15,r19
 1289 0490 042B      		or r16,r20
 1290 0492 152B      		or r17,r21
 1292               	.LM175:
 1293 0494 8C81      		ldd r24,Y+4
 1294 0496 9927      		clr r25
 1295 0498 AA27      		clr r26
 1296 049a BB27      		clr r27
 1297 049c E82A      		or r14,r24
 1298 049e F92A      		or r15,r25
 1299 04a0 0A2B      		or r16,r26
 1300 04a2 1B2B      		or r17,r27
 1301 04a4 02C0      		rjmp .L161
 1302               	.L137:
 1304               	.LM176:
 1305 04a6 FB01      		movw r30,r22
 1306 04a8 1582      		std Z+5,__zero_reg__
 1307               	.L161:
 1309               	.LM177:
 1310 04aa E082      		st Z,r14
 1311 04ac F182      		std Z+1,r15
 1312 04ae 0283      		std Z+2,r16
 1313 04b0 1383      		std Z+3,r17
 1314               	.LBB102:
 1315               	.LBB103:
 1316               	.LBB104:
 1317               	.LBB105:
 1319               	.LM178:
 1320 04b2 1EBC      		out 78-0x20,__zero_reg__
 1321               	.L140:
 1323               	.LM179:
 1324 04b4 0DB4      		in __tmp_reg__,77-0x20
 1325 04b6 07FE      		sbrs __tmp_reg__,7
 1326 04b8 FDCF      		rjmp .L140
 1328               	.LM180:
 1329 04ba 8EB5      		in r24,78-0x20
 1330               	.LBE105:
 1331               	.LBE104:
 1332               	.LBE103:
 1333               	.LBE102:
 1335               	.LM181:
 1336 04bc 982F      		mov r25,r24
 1338               	.LM182:
 1339 04be 8F70      		andi r24,lo8(15)
 1340 04c0 FB01      		movw r30,r22
 1341 04c2 8483      		std Z+4,r24
 1343               	.LM183:
 1344 04c4 8930      		cpi r24,lo8(9)
 1345 04c6 10F0      		brlo .L142
 1346 04c8 88E0      		ldi r24,lo8(8)
 1347 04ca 8483      		std Z+4,r24
 1348               	.L142:
 1350               	.LM184:
 1351 04cc FB01      		movw r30,r22
 1352 04ce 1682      		std Z+6,__zero_reg__
 1353 04d0 96FF      		sbrs r25,6
 1354 04d2 02C0      		rjmp .L144
 1355 04d4 81E0      		ldi r24,lo8(1)
 1356 04d6 8683      		std Z+6,r24
 1357               	.L144:
 1358 04d8 20E0      		ldi r18,lo8(0)
 1359 04da 30E0      		ldi r19,hi8(0)
 1360 04dc 0BC0      		rjmp .L145
 1361               	.L146:
 1362               	.LBB106:
 1363               	.LBB107:
 1364               	.LBB108:
 1365               	.LBB109:
 1367               	.LM185:
 1368 04de 1EBC      		out 78-0x20,__zero_reg__
 1369               	.L147:
 1371               	.LM186:
 1372 04e0 0DB4      		in __tmp_reg__,77-0x20
 1373 04e2 07FE      		sbrs __tmp_reg__,7
 1374 04e4 FDCF      		rjmp .L147
 1376               	.LM187:
 1377 04e6 8EB5      		in r24,78-0x20
 1378               	.LBE109:
 1379               	.LBE108:
 1380               	.LBE107:
 1381               	.LBE106:
 1383               	.LM188:
 1384 04e8 FB01      		movw r30,r22
 1385 04ea E90F      		add r30,r25
 1386 04ec F11D      		adc r31,__zero_reg__
 1387 04ee 8783      		std Z+7,r24
 1388 04f0 2F5F      		subi r18,lo8(-(1))
 1389 04f2 3F4F      		sbci r19,hi8(-(1))
 1390               	.L145:
 1391 04f4 922F      		mov r25,r18
 1393               	.LM189:
 1394 04f6 FB01      		movw r30,r22
 1395 04f8 8481      		ldd r24,Z+4
 1396 04fa 2817      		cp r18,r24
 1397 04fc 80F3      		brlo .L146
 1399               	.LM190:
 1400 04fe 439A      		sbi 40-0x20,3
 1401               	/* epilogue: frame size=4 */
 1402 0500 2496      		adiw r28,4
 1403 0502 0FB6      		in __tmp_reg__,__SREG__
 1404 0504 F894      		cli
 1405 0506 DEBF      		out __SP_H__,r29
 1406 0508 0FBE      		out __SREG__,__tmp_reg__
 1407 050a CDBF      		out __SP_L__,r28
 1408 050c DF91      		pop r29
 1409 050e CF91      		pop r28
 1410 0510 1F91      		pop r17
 1411 0512 0F91      		pop r16
 1412 0514 FF90      		pop r15
 1413 0516 EF90      		pop r14
 1414 0518 0895      		ret
 1415               	/* epilogue end (size=13) */
 1416               	/* function MCP2515_ReadCanMsg size 165 (138) */
 1423               	.Lscope14:
 1425               	.global	MCP2515_ReadStatus
 1427               	MCP2515_ReadStatus:
 1429               	.LM191:
 1430               	/* prologue: frame size=0 */
 1431               	/* prologue end (size=0) */
 1433               	.LM192:
 1434 051a 4398      		cbi 40-0x20,3
 1435               	.LBB116:
 1436               	.LBB117:
 1438               	.LM193:
 1439 051c 80EA      		ldi r24,lo8(-96)
 1440 051e 8EBD      		out 78-0x20,r24
 1441               	.L163:
 1443               	.LM194:
 1444 0520 0DB4      		in __tmp_reg__,77-0x20
 1445 0522 07FE      		sbrs __tmp_reg__,7
 1446 0524 FDCF      		rjmp .L163
 1448               	.LM195:
 1449 0526 8EB5      		in r24,78-0x20
 1450               	.LBE117:
 1451               	.LBE116:
 1452               	.LBB118:
 1453               	.LBB119:
 1454               	.LBB120:
 1455               	.LBB121:
 1457               	.LM196:
 1458 0528 1EBC      		out 78-0x20,__zero_reg__
 1459               	.L165:
 1461               	.LM197:
 1462 052a 0DB4      		in __tmp_reg__,77-0x20
 1463 052c 07FE      		sbrs __tmp_reg__,7
 1464 052e FDCF      		rjmp .L165
 1466               	.LM198:
 1467 0530 8EB5      		in r24,78-0x20
 1468               	.LBE121:
 1469               	.LBE120:
 1470               	.LBE119:
 1471               	.LBE118:
 1473               	.LM199:
 1474 0532 439A      		sbi 40-0x20,3
 1476               	.LM200:
 1477 0534 9927      		clr r25
 1478               	/* epilogue: frame size=0 */
 1479 0536 0895      		ret
 1480               	/* epilogue end (size=1) */
 1481               	/* function MCP2515_ReadStatus size 15 (14) */
 1483               	.Lscope15:
 1486               	.global	Can_Receive
 1488               	Can_Receive:
 506:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 507:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /**
 508:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Sends a CAN message immediately with the controller hardware. If the CAN
 509:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * controller is busy, the function will return CAN_FAIL.
 510:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
 511:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @param msg
 512:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		Pointer to the CAN message storage buffer.
 513:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 514:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @return
 515:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		CAN_OK if the message was successfully sent to the controller.
 516:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		CAN_FAIL if the controller is busy.
 517:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  */
 518:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** Can_Return_t Can_Send(Can_Message_t *msg) {
 519:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		/*
 520:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		 * Send with MCP2515 device.
 521:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		 */
 522:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		uint8_t txbuf_n;
 523:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		txbuf_n = MCP2515_GetNextFreeTXBuf();
 524:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		if (txbuf_n == MCP_ALLTXBUSY) {
 525:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 			// TODO: Maybe we should block until a buffer is available?
 526:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 			return CAN_FAIL;
 527:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		}
 528:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_WriteCanMsg(txbuf_n, msg);
 529:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_StartTransmit(txbuf_n);
 530:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		return CAN_OK;
 531:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** }
 532:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 533:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 
 534:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** /**
 535:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * Receives a CAN message from the CAN controller hardware.
 536:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * 
 537:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @param msg
 538:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		Pointer to the message storage buffer into which the message should be copied.
 539:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *
 540:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  * @return
 541:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		CAN_OK if a received message was successfully copied into the buffer.
 542:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  *		CAN_NO_MSG_AVAILABLE if there is no message available in the controller.
 543:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c ****  */
 544:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** Can_Return_t Can_Receive(Can_Message_t *msg) {
 1490               	.LM201:
 1491               	/* prologue: frame size=0 */
 1492 0538 CF93      		push r28
 1493 053a DF93      		push r29
 1494               	/* prologue end (size=2) */
 1495 053c EC01      		movw r28,r24
 545:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	/*
 546:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	 * Receive from MCP2515 device.
 547:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	 */
 548:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	uint8_t stat;
 549:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	static uint8_t buffer = 0;
 550:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 551:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	stat = MCP2515_ReadStatus() & MCP_STAT_RXIF_MASK;
 1497               	.LM202:
 1498 053e 0E94 0000 		call MCP2515_ReadStatus
 1499 0542 8370      		andi r24,lo8(3)
 552:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	
 553:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	if (stat > 2) {
 1501               	.LM203:
 1502 0544 8330      		cpi r24,lo8(3)
 1503 0546 40F0      		brlo .L173
 554:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// Both buffers contain data, read the one previously not read.
 555:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// (Bit 0 in buffer selects which buffer to read, no need to take modulus 2)
 556:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ReadCanMsg(buffer++, msg);
 1505               	.LM204:
 1506 0548 8091 0000 		lds r24,buffer.1622
 1507 054c 8F5F      		subi r24,lo8(-(1))
 1508 054e 8093 0000 		sts buffer.1622,r24
 1509 0552 8150      		subi r24,lo8(-(-1))
 1510 0554 BE01      		movw r22,r28
 1511 0556 07C0      		rjmp .L179
 1512               	.L173:
 557:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 	} else if (stat > 0) {
 1514               	.LM205:
 1515 0558 8823      		tst r24
 1516 055a 19F4      		brne .L176
 1517 055c 8EEF      		ldi r24,lo8(-2)
 1518 055e 9FEF      		ldi r25,hi8(-2)
 1519 0560 06C0      		rjmp .L175
 1520               	.L176:
 558:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		// One of the buffers contain data, read it
 559:/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.c **** 		MCP2515_ReadCanMsg(stat-1, msg);
 1522               	.LM206:
 1523 0562 BE01      		movw r22,r28
 1524 0564 8150      		subi r24,lo8(-(-1))
 1525               	.L179:
 1526 0566 0E94 0000 		call MCP2515_ReadCanMsg
 1527 056a 81E0      		ldi r24,lo8(1)
 1528 056c 90E0      		ldi r25,hi8(1)
 1529               	.L175:
 1530               	/* epilogue: frame size=0 */
 1531 056e DF91      		pop r29
 1532 0570 CF91      		pop r28
 1533 0572 0895      		ret
 1534               	/* epilogue end (size=3) */
 1535               	/* function Can_Receive size 30 (25) */
 1541               	.Lscope16:
 1543               	.global	__vector_boot_2
 1545               	__vector_boot_2:
 1547               	.LM207:
 1548               	/* prologue: frame size=0 */
 1549 0574 1F92      		push __zero_reg__
 1550 0576 0F92      		push __tmp_reg__
 1551 0578 0FB6      		in __tmp_reg__,__SREG__
 1552 057a 0F92      		push __tmp_reg__
 1553 057c 1124      		clr __zero_reg__
 1554 057e 2F93      		push r18
 1555 0580 3F93      		push r19
 1556 0582 4F93      		push r20
 1557 0584 5F93      		push r21
 1558 0586 6F93      		push r22
 1559 0588 7F93      		push r23
 1560 058a 8F93      		push r24
 1561 058c 9F93      		push r25
 1562 058e AF93      		push r26
 1563 0590 BF93      		push r27
 1564 0592 EF93      		push r30
 1565 0594 FF93      		push r31
 1566               	/* prologue end (size=17) */
 1568               	.LM208:
 1569 0596 80E0      		ldi r24,lo8(msgbuf)
 1570 0598 90E0      		ldi r25,hi8(msgbuf)
 1571 059a 0E94 0000 		call Can_Receive
 1572 059e 8130      		cpi r24,lo8(1)
 1573 05a0 21F4      		brne .L183
 1575               	.LM209:
 1576 05a2 80E0      		ldi r24,lo8(msgbuf)
 1577 05a4 90E0      		ldi r25,hi8(msgbuf)
 1578 05a6 0E94 0000 		call Can_Process
 1579               	.L183:
 1580               	/* epilogue: frame size=0 */
 1581 05aa FF91      		pop r31
 1582 05ac EF91      		pop r30
 1583 05ae BF91      		pop r27
 1584 05b0 AF91      		pop r26
 1585 05b2 9F91      		pop r25
 1586 05b4 8F91      		pop r24
 1587 05b6 7F91      		pop r23
 1588 05b8 6F91      		pop r22
 1589 05ba 5F91      		pop r21
 1590 05bc 4F91      		pop r20
 1591 05be 3F91      		pop r19
 1592 05c0 2F91      		pop r18
 1593 05c2 0F90      		pop __tmp_reg__
 1594 05c4 0FBE      		out __SREG__,__tmp_reg__
 1595 05c6 0F90      		pop __tmp_reg__
 1596 05c8 1F90      		pop __zero_reg__
 1597 05ca 1895      		reti
 1598               	/* epilogue end (size=17) */
 1599               	/* function __vector_boot_2 size 44 (10) */
 1601               	.Lscope17:
 1603               	.global	MCP2515_GetNextFreeTXBuf
 1605               	MCP2515_GetNextFreeTXBuf:
 1607               	.LM210:
 1608               	/* prologue: frame size=0 */
 1609               	/* prologue end (size=0) */
 1611               	.LM211:
 1612 05cc E998      		cbi 61-0x20,1
 1614               	.LM212:
 1615 05ce 0E94 0000 		call MCP2515_ReadStatus
 1617               	.LM213:
 1618 05d2 E99A      		sbi 61-0x20,1
 1620               	.LM214:
 1621 05d4 9927      		clr r25
 1622 05d6 82FD      		sbrc r24,2
 1623 05d8 03C0      		rjmp .L185
 1625               	.LM215:
 1626 05da 80E0      		ldi r24,lo8(0)
 1627 05dc 90E0      		ldi r25,hi8(0)
 1628 05de 0895      		ret
 1629               	.L185:
 1631               	.LM216:
 1632 05e0 84FD      		sbrc r24,4
 1633 05e2 03C0      		rjmp .L188
 1634 05e4 81E0      		ldi r24,lo8(1)
 1635 05e6 90E0      		ldi r25,hi8(1)
 1636 05e8 0895      		ret
 1637               	.L188:
 1639               	.LM217:
 1640 05ea 86FD      		sbrc r24,6
 1641 05ec 03C0      		rjmp .L190
 1642 05ee 82E0      		ldi r24,lo8(2)
 1643 05f0 90E0      		ldi r25,hi8(2)
 1644 05f2 0895      		ret
 1645               	.L190:
 1646 05f4 8FEF      		ldi r24,lo8(255)
 1647 05f6 90E0      		ldi r25,hi8(255)
 1649               	.LM218:
 1650 05f8 0895      		ret
 1651               	/* epilogue: frame size=0 */
 1652               	/* epilogue: noreturn */
 1653               	/* epilogue end (size=0) */
 1654               	/* function MCP2515_GetNextFreeTXBuf size 23 (23) */
 1656               	.Lscope18:
 1659               	.global	Can_Send
 1661               	Can_Send:
 1663               	.LM219:
 1664               	/* prologue: frame size=0 */
 1665 05fa 1F93      		push r17
 1666 05fc CF93      		push r28
 1667 05fe DF93      		push r29
 1668               	/* prologue end (size=3) */
 1669 0600 EC01      		movw r28,r24
 1671               	.LM220:
 1672 0602 0E94 0000 		call MCP2515_GetNextFreeTXBuf
 1673 0606 182F      		mov r17,r24
 1675               	.LM221:
 1676 0608 8F3F      		cpi r24,lo8(-1)
 1677 060a 19F4      		brne .L194
 1679               	.LM222:
 1680 060c 8FEF      		ldi r24,lo8(-1)
 1681 060e 9FEF      		ldi r25,hi8(-1)
 1682 0610 08C0      		rjmp .L196
 1683               	.L194:
 1685               	.LM223:
 1686 0612 BE01      		movw r22,r28
 1687 0614 0E94 0000 		call MCP2515_WriteCanMsg
 1689               	.LM224:
 1690 0618 812F      		mov r24,r17
 1691 061a 0E94 0000 		call MCP2515_StartTransmit
 1692 061e 81E0      		ldi r24,lo8(1)
 1693 0620 90E0      		ldi r25,hi8(1)
 1694               	.L196:
 1695               	/* epilogue: frame size=0 */
 1696 0622 DF91      		pop r29
 1697 0624 CF91      		pop r28
 1698 0626 1F91      		pop r17
 1699 0628 0895      		ret
 1700               	/* epilogue end (size=4) */
 1701               	/* function Can_Send size 24 (17) */
 1706               	.Lscope19:
 1707               		.lcomm buffer.1622,1
 1709               		.lcomm msgbuf,15
 1712               	.Letext0:
 1713               	/* File "/home/linus/HomeAutomation/trunk/EmbeddedSoftware/AVR/avr-lib/drivers/can/mcp2515/mcp2515.
DEFINED SYMBOLS
                            *ABS*:00000000 mcp2515.c
     /tmp/ccPXGC4D.s:3      *ABS*:0000003f __SREG__
     /tmp/ccPXGC4D.s:4      *ABS*:0000003e __SP_H__
     /tmp/ccPXGC4D.s:5      *ABS*:0000003d __SP_L__
     /tmp/ccPXGC4D.s:6      *ABS*:00000000 __tmp_reg__
     /tmp/ccPXGC4D.s:7      *ABS*:00000001 __zero_reg__
     /tmp/ccPXGC4D.s:73     .text:00000000 MCP2515_Reset
     /tmp/ccPXGC4D.s:158    .text:00000058 MCP2515_StartTransmit
     /tmp/ccPXGC4D.s:212    .text:0000007c MCP2515_SPIWriteCanId
     /tmp/ccPXGC4D.s:348    .text:00000112 MCP2515_WriteCanMsg
     /tmp/ccPXGC4D.s:476    .text:00000178 MCP2515_WriteCanId
     /tmp/ccPXGC4D.s:538    .text:000001a2 MCP2515_ReadRegister
     /tmp/ccPXGC4D.s:617    .text:000001cc MCP2515_SetRegister
     /tmp/ccPXGC4D.s:687    .text:000001f4 MCP2515_InitRXInterrupts
     /tmp/ccPXGC4D.s:714    .text:00000208 MCP2515_InitCanBuffers
     /tmp/ccPXGC4D.s:843    .text:000002d0 MCP2515_ConfigRate
     /tmp/ccPXGC4D.s:875    .text:000002ea MCP2515_ModifyRegister
     /tmp/ccPXGC4D.s:963    .text:0000031c MCP2515_SetCanCtrl
     /tmp/ccPXGC4D.s:1007   .text:0000034c MCP2515_Init
     /tmp/ccPXGC4D.s:1104   .text:000003b0 Can_Init
     /tmp/ccPXGC4D.s:1141   .text:000003d0 MCP2515_ReadCanMsg
     /tmp/ccPXGC4D.s:1427   .text:0000051a MCP2515_ReadStatus
     /tmp/ccPXGC4D.s:1488   .text:00000538 Can_Receive
                             .bss:00000000 buffer.1622
     /tmp/ccPXGC4D.s:1545   .text:00000574 __vector_boot_2
     /tmp/ccPXGC4D.s:1707   .bss:00000001 msgbuf
     /tmp/ccPXGC4D.s:1605   .text:000005cc MCP2515_GetNextFreeTXBuf
     /tmp/ccPXGC4D.s:1661   .text:000005fa Can_Send

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
Can_Process
